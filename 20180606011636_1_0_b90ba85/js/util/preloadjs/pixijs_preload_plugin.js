define(["underscore","createjs","pixi"],function(e,t,r){"use strict";function i(e){this.AbstractLoader_constructor(e,!0,t.AbstractLoader.XML)}var s=t.extend(i,t.AbstractLoader),n=i;s.canLoadItem=function(e){return e.type===t.AbstractLoader.XML},s._createRequest=function(){this._request=new r.BitmapFontLoader(this._item.src,this._item.crossOrigin)},s.load=function(){this._createRequest(),this._request.on("loaded",e.bind(this._onLoaded,this));var r=new t.Event("initialize");r.loader=this._request,this.dispatchEvent(r),this._request.load()},s._onLoaded=function(){var e=this.resultFormatter&&this.resultFormatter(this),t=this;e instanceof Function?e(function(e){t._result=e,t._sendComplete()}):(this._result=e||this._rawResult,this._sendComplete())},s.destroy=function(){this._request&&this._request.removeAllListeners(),this._request=null,this._item=null,this._rawResult=null,this._result=null,this._loadItems=null,this.removeAllEventListeners()},t.promote(i,"AbstractLoader");var a=function(){};return n=a,n.getPreloadHandlers=function(){return{callback:n.preloadHandler,types:["image"],extensions:["jpg","jpeg","png","gif","fnt","xml"]}},n.preloadHandler=function(r,s){if(r.pixijs){var a;switch(r.type){case t.AbstractLoader.IMAGE:a=new t.ImageLoader(r,s.preferXHR),a.on("complete",e.bind(n.fileLoadHandler,n));break;case t.AbstractLoader.XML:a=new i(r),a.on("complete",e.bind(n.fileLoadHandler,n));break;default:throw new Error("Not handler for type: "+r.type)}return a}return!0},n.fileLoadHandler=function(e){var t=e.target,r=t.getItem();r.pixijs&&"image"===r.type&&this._handleImage(r,e)},n._handleImage=function(t,i){var s=t.pixijs.ns,n=i.result,a=new r.BaseTexture(n);if(t.pixijs.sprites){var o;e.each(t.pixijs.sprites,function(e){o=r.TextureCache[s+e.id]=new r.Texture(a,{x:e.x,y:e.y,width:e.width,height:e.height}),e.trim&&(o.trim=new r.Rectangle(e.trim.offsetX,e.trim.offsetY,e.trim.origWidth,e.trim.origHeight))},this)}},a});