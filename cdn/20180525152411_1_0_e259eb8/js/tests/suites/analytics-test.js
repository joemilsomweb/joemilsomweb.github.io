define(["jquery","underscore","config","libs/mocha","libs/expect","controller/tracking_controller","model/tracking_collection","view/common/communicator","events/view_events"],function(n,t,i,e,o,r,a,c,l){return function(){e.ui("bdd"),describe("Analytics",function(){afterEach(function(){a.off(null,null,this),c.off(null,null,this)}),it("should contain tracks",function(){o(a.length).to.be.greaterThan(0)}),it("should fire a track event on the tracking collection",function(n){var t=a.at(0);a.on(a.events.TRACK_FIRED,function(i){o(i.id).to.be(t.id),n()},this),a.track(t.id)}),it("should fire a track event containing a variable",function(n){var i=a.find(function(n){return n.get("variables").length});if(!i)throw new Error("No tracks containing variables");var e=t.uniqueId("analytics-test"),r={},c=i.get("variables")[0];r[c]=e,a.on(a.events.TRACK_FIRED,function(r){o(r.id).to.be(i.id),o(r.variables).to.contain(c);var a=t.find(r,function(n){return t.isString(n)&&n.indexOf(e)>-1});o(a).to.not.be(null),o(a).to.contain(e),n()},this),a.track(i.id,r)}),it("should fire a track event when requested from the view",function(n){var t=a.at(0);a.on(a.events.TRACK_FIRED,function(i){o(i.id).to.be(t.id),n()},this),c.trigger(l.TRACKING,t.id)}),it("should fire a track event containing a variable when requested via the view",function(n){var i=a.find(function(n){return n.get("variables").length});if(!i)throw new Error("No tracks containing variables");var e=t.uniqueId("analytics-test"),r={},u=i.get("variables")[0];r[u]=e,a.on(a.events.TRACK_FIRED,function(r){o(r.id).to.be(i.id),o(r.variables).to.contain(u);var a=t.find(r,function(n){return t.isString(n)&&n.indexOf(e)>-1});o(a).to.not.be(null),o(a).to.contain(e),n()},this),c.trigger(l.TRACKING,i.id,r)})})}});