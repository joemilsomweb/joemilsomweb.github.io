define(["underscore","util/createjs","createjs"],function(e,t,i){"use strict";var a=i.Bitmap.prototype.initialize;i.Bitmap.prototype.initialize=function(){a.apply(this,arguments),this.image instanceof i.Bitmap&&(this.sourceRect=this.image.sourceRect,this.image=this.image.image)};var r=function(){},n=r;return n.getPreloadHandlers=function(){return{callback:n.preloadHandler,types:["image"],extensions:["jpg","jpeg","png","gif"]}},n.preloadHandler=function(t,a){if(t.createjs){var r=new i.ImageLoader(t,a.preferXHR);return r.on("complete",e.bind(n.fileLoadHandler,n)),r}return!0},n.fileLoadHandler=function(i){var a=i.target,r=a.getItem();if(r.createjs){var n=r.createjs.ns;if(t.images[n]||(t.images[n]={}),r.createjs.spritesheet){var s,c,g=a.getResult();e.each(r.createjs.spritesheet,function(e){s=document.createElement("canvas"),s.width=e.width,s.height=e.height,c=s.getContext("2d"),c.drawImage(g,e.x,e.y,e.width,e.height,0,0,e.width,e.height),t.images[n][e.id]=s})}else t.images[n][r.createjs.id]=a.getResult()}},r});