define(["jquery","underscore","backbone","data/tracking_data"],function(e,r,t,n){var i={},a=t.Collection.extend({events:{TRACK_FIRED:"TRACK_FIRED"},initialize:function(){},track:function(e,t){var a=this.get(e);if(!a)throw new Error("Track not found: "+e);var o,s;if(o=s=a.toJSON(),s.variables.length){var c=r.difference(s.variables,r.keys(t));if(c&&c.length)throw new Error("Track missing variable values: "+c);var f,l;o=r.mapObject(s,function(a,o){return r.isString(a)?(l=e+"_"+o,i.hasOwnProperty(l)||(i[l]=r.template(a,{interpolate:n.TRACK_VAR_REGEXP})),(f=i[l])(t)):a})}this.trigger(this.events.TRACK_FIRED,o)}});return new a(n.TRACK_DATA)});